CREATE TABLESPACE "COLLECTION_COMMENT"
  IN DATABASE PARTITION GROUP "IBMDEFAULTGROUP"
  PAGESIZE 32K
  MANAGED BY DATABASE 
  USING
   (File 'f:\COLLECTION_COMMENT\COLLECTION_COMMENT01' 256, File 'N:\COLLECTION_COMMENT\COLLECTION_COMMENT02' 256
--history--   (File 'H:\COLLECTION_COMMENT\COLLECTION_COMMENT01' 256, File 'O:\COLLECTION_COMMENT\COLLECTION_COMMENT02' 256
   )
  EXTENTSIZE 32
  PREFETCHSIZE AUTOMATIC
  BUFFERPOOL "BP1"
--history--  BUFFERPOOL HISTDATABP
  OVERHEAD 12.50
  TRANSFERRATE 0.13
  DROPPED TABLE RECOVERY ON
  AUTORESIZE YES 
  INCREASESIZE 10 PERCENT
  MAXSIZE NONE;
  
  
  CREATE TABLE GICROP02.COLLECTION_COMMENTS  
   ("RID"                       INTEGER         NOT NULL  GENERATED BY DEFAULT
      AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER),
  	COLLECTIONPRODUCERRID INTEGER, 
	"COMMENT" VARCHAR(2500), 
	VERSACTIONTYPE CHARACTER(1), 
	VERSUSERID CHARACTER(25), 
	VERSEFFDATE TIMESTAMP, 
	CREATE_USER CHARACTER(30), 
	CREATE_DATE TIMESTAMP
  	
  )
    DATA CAPTURE NONE
    IN COLLECTION_COMMENT;
  
  ALTER TABLE GICROP02.COLLECTION_COMMENTS
    LOCKSIZE ROW
    APPEND OFF
    NOT VOLATILE;
  
  COMMENT ON TABLE GICROP02.COLLECTION_COMMENTS IS 'TPS-00045-013';
  
  GRANT SELECT,INSERT,UPDATE,DELETE    ON TABLE GICROP02.COLLECTION_COMMENTS  TO GROUP CROPUDBU;
  GRANT SELECT,INSERT,UPDATE,DELETE    ON TABLE GICROP02.COLLECTION_COMMENTS  TO GROUP CROPUDBD;
  
  ALTER TABLE GICROP02.COLLECTION_COMMENTS
    ADD CONSTRAINT "COLLECTION_COMMENTSPKEY" PRIMARY KEY
     ("RID"
   );
   
   ALTER TABLE GICROP02.COLLECTION_COMMENTS
     ADD CONSTRAINT COLLECTION_COMMENTS1FK FOREIGN KEY
      (COLLECTIONPRODUCERRID
      )
       REFERENCES GICROP02.COLLECTION_PRODUCER
        (RID
        )
       ON DELETE RESTRICT
       ON UPDATE NO ACTION
       ENFORCED
    ENABLE QUERY OPTIMIZATION;
    
    --call gicrop02.MYHISTORY('GICROP02','GICROP03','COLLECTION_COMMENTS');
    
    --DROP TABLE GICROP03.COLLECTION_COMMENTS;
    --DROP TABLESPACE COLLECTION_CO_HIST;
    --
    CREATE TABLESPACE COLLECTION_CO_HIST
      IN DATABASE PARTITION GROUP IBMDEFAULTGROUP
      PAGESIZE 32K
      MANAGED BY DATABASE 
      USING
       (File 'H:\COLLECTION_COMMENTS_HIST\COLLECTION_COMMENTS_HIST01' 256, File 'O:\COLLECTION_COMMENTS_HIST\COLLECTION_COMMENTS_HIST02' 256
       )
      EXTENTSIZE 32
      PREFETCHSIZE AUTOMATIC
      BUFFERPOOL HISTDATABP
      OVERHEAD 12.50
      TRANSFERRATE 0.13
      DROPPED TABLE RECOVERY ON
      AUTORESIZE YES 
      INCREASESIZE 10 PERCENT
      MAXSIZE NONE;
    
    
    CREATE TABLE GICROP03.COLLECTION_COMMENTS
     (HISTORYRID                       INTEGER         NOT NULL  GENERATED BY DEFAULT
        AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20, MINVALUE 1, MAXVALUE 2147483647, NO CYCLE, NO ORDER)
      ,RID INTEGER
      ,COLLECTIONPRODUCERRID INTEGER
      ,COMMENT VARCHAR(2500)
      ,VERSACTIONTYPE CHAR(1)
      ,VERSUSERID CHAR(25)
      ,VERSEFFDATE TIMESTAMP
      ,CREATE_USER CHAR(30)
      ,CREATE_DATE TIMESTAMP
    )
      DATA CAPTURE NONE
      IN COLLECTION_CO_HIST;
    
    ALTER TABLE GICROP03.COLLECTION_COMMENTS
      LOCKSIZE ROW
      APPEND OFF
      NOT VOLATILE;
    
    
    GRANT SELECT    ON TABLE GICROP03.COLLECTION_COMMENTS  TO GROUP CROPUDBU;
    GRANT SELECT    ON TABLE GICROP03.COLLECTION_COMMENTS  TO GROUP CROPUDBD;
    
    ALTER TABLE GICROP03.COLLECTION_COMMENTS
      ADD CONSTRAINT COLLECTION_COMMENTSHPKEY PRIMARY KEY
       (HISTORYRID
       );
    

    --call gicrop02.MYTRIGGERS('GICROP02','GICROP03','COLLECTION_COMMENTS');
    
    
    --drop trigger GICROP02.COLLECTION_COMMENTSI;
    --drop trigger GICROP02.COLLECTION_COMMENTSU;
    --drop trigger GICROP02.COLLECTION_COMMENTSD;
    SET CURRENT SCHEMA GICROP02;
    SET CURRENT PATH = SYSIBM,SYSFUN,SYSPROC, GICROP02;
    
    CREATE TRIGGER GICROP02.COLLECTION_COMMENTSI 
      AFTER INSERT 
      ON GICROP02.COLLECTION_COMMENTS 
      REFERENCING 
        NEW AS CROP02 
      FOR EACH ROW 
    INSERT INTO GICROP03.COLLECTION_COMMENTS(RID ,COLLECTIONPRODUCERRID,COMMENT,CREATE_DATE,CREATE_USER
    ,VERSEFFDATE,VERSACTIONTYPE,VERSUSERID) 
    VALUES (CROP02.RID ,CROP02.COLLECTIONPRODUCERRID,CROP02.COMMENT,CROP02.CREATE_DATE,CROP02.CREATE_USER
    ,CURRENT TIMESTAMP, 
      'I', 
      case 
      when VERSUSERID is NOT NULL and VERSUSERID <> ' ' then UPPER(VERSUSERID) 
      when (CLIENT USERID = ' ' or CLIENT USERID is null) then UPPER(CURRENT USER) else UPPER(CLIENT USERID) 
      end); 
    
    CREATE TRIGGER GICROP02.COLLECTION_COMMENTSU 
      AFTER UPDATE 
      ON GICROP02.COLLECTION_COMMENTS 
      REFERENCING 
        NEW AS CROP02 
      FOR EACH ROW 
    INSERT INTO GICROP03.COLLECTION_COMMENTS(RID ,COLLECTIONPRODUCERRID,COMMENT,CREATE_DATE,CREATE_USER
    ,VERSEFFDATE,VERSACTIONTYPE,VERSUSERID) 
    VALUES (CROP02.RID ,CROP02.COLLECTIONPRODUCERRID,CROP02.COMMENT,CROP02.CREATE_DATE,CROP02.CREATE_USER
    ,CURRENT TIMESTAMP, 
    'U', 
    case 
      when VERSUSERID is NOT NULL and VERSUSERID <> ' ' then UPPER(VERSUSERID) 
      when (CLIENT USERID = ' ' or CLIENT USERID is null) then UPPER(CURRENT USER) else UPPER(CLIENT USERID) 
      end); 
    
    CREATE TRIGGER GICROP02.COLLECTION_COMMENTSD 
      AFTER DELETE 
      ON GICROP02.COLLECTION_COMMENTS 
      REFERENCING 
        OLD AS CROP02 
      FOR EACH ROW 
    INSERT INTO GICROP03.COLLECTION_COMMENTS(RID ,COLLECTIONPRODUCERRID,COMMENT,CREATE_DATE,CREATE_USER
    ,VERSEFFDATE,VERSACTIONTYPE,VERSUSERID) 
    VALUES (CROP02.RID ,CROP02.COLLECTIONPRODUCERRID,CROP02.COMMENT,CROP02.CREATE_DATE,CROP02.CREATE_USER
    ,CURRENT TIMESTAMP 
    ,'D' 
    ,case 
      when (CLIENT USERID = ' ' or CLIENT USERID is null) then UPPER(CURRENT USER) else UPPER(CLIENT USERID) 
  end); 
