/*Verification */

select tabschema, tabname, colname, typename, length, scale, nulls, identity 
from syscat.columns where tabname in ('MPBFRHD') and tabschema in ('GICROP02', 'GICROP03')
and colname in ('AIPPRODUCERCERTIFICATIONKEY'
);


/* Add Column */

ALTER TABLE GICROP02.MPBFRHD
  ADD COLUMN AIPPRODUCERCERTIFICATIONKEY	INTEGER;
  
COMMENT ON GICROP02.MPBFRHD ( 
	AIPPRODUCERCERTIFICATIONKEY IS 'TPS-12340-085'
	);
  
ALTER TABLE GICROP03.MPBFRHD
  ADD COLUMN AIPPRODUCERCERTIFICATIONKEY	INTEGER;
  
  
/* Triggers */
  
--call gicrop02.mytriggers('GICROP02','GICROP03','MPBFRHD');

drop trigger GICROP02.MPBFRHDI;
drop trigger GICROP02.MPBFRHDU;
drop trigger GICROP02.MPBFRHDD;
SET CURRENT SCHEMA GICROP02;
SET CURRENT PATH = SYSIBM,SYSFUN,SYSPROC, GICROP02;

CREATE TRIGGER GICROP02.MPBFRHDI 
  AFTER INSERT 
  ON GICROP02.MPBFRHD 
  REFERENCING 
    NEW AS CROP02 
  FOR EACH ROW 
INSERT INTO GICROP03.MPBFRHD(RID ,AIPPRODUCERCERTIFICATIONKEY,CANCELDATE,CERTSIGNDATE,IDTYPE,PRODUCER,REINYEAR,RMAACCEPTDATE,SBI,TAXNUM
,VERSEFFDATE,VERSACTIONTYPE,VERSUSERID) 
VALUES (CROP02.RID ,CROP02.AIPPRODUCERCERTIFICATIONKEY,CROP02.CANCELDATE,CROP02.CERTSIGNDATE,CROP02.IDTYPE,CROP02.PRODUCER,CROP02.REINYEAR,CROP02.RMAACCEPTDATE,CROP02.SBI,CROP02.TAXNUM
,CURRENT TIMESTAMP, 
  'I', 
  case 
  when VERSUSERID is NOT NULL and VERSUSERID <> ' ' then UPPER(VERSUSERID) 
  when (CLIENT USERID = ' ' or CLIENT USERID is null) then UPPER(CURRENT USER) else UPPER(CLIENT USERID) 
  end); 

CREATE TRIGGER GICROP02.MPBFRHDU 
  AFTER UPDATE 
  ON GICROP02.MPBFRHD 
  REFERENCING 
    NEW AS CROP02 
  FOR EACH ROW 
INSERT INTO GICROP03.MPBFRHD(RID ,AIPPRODUCERCERTIFICATIONKEY,CANCELDATE,CERTSIGNDATE,IDTYPE,PRODUCER,REINYEAR,RMAACCEPTDATE,SBI,TAXNUM
,VERSEFFDATE,VERSACTIONTYPE,VERSUSERID) 
VALUES (CROP02.RID ,CROP02.AIPPRODUCERCERTIFICATIONKEY,CROP02.CANCELDATE,CROP02.CERTSIGNDATE,CROP02.IDTYPE,CROP02.PRODUCER,CROP02.REINYEAR,CROP02.RMAACCEPTDATE,CROP02.SBI,CROP02.TAXNUM
,CURRENT TIMESTAMP, 
'U', 
case 
  when VERSUSERID is NOT NULL and VERSUSERID <> ' ' then UPPER(VERSUSERID) 
  when (CLIENT USERID = ' ' or CLIENT USERID is null) then UPPER(CURRENT USER) else UPPER(CLIENT USERID) 
  end); 

CREATE TRIGGER GICROP02.MPBFRHDD 
  AFTER DELETE 
  ON GICROP02.MPBFRHD 
  REFERENCING 
    OLD AS CROP02 
  FOR EACH ROW 
INSERT INTO GICROP03.MPBFRHD(RID ,AIPPRODUCERCERTIFICATIONKEY,CANCELDATE,CERTSIGNDATE,IDTYPE,PRODUCER,REINYEAR,RMAACCEPTDATE,SBI,TAXNUM
,VERSEFFDATE,VERSACTIONTYPE,VERSUSERID) 
VALUES (CROP02.RID ,CROP02.AIPPRODUCERCERTIFICATIONKEY,CROP02.CANCELDATE,CROP02.CERTSIGNDATE,CROP02.IDTYPE,CROP02.PRODUCER,CROP02.REINYEAR,CROP02.RMAACCEPTDATE,CROP02.SBI,CROP02.TAXNUM
,CURRENT TIMESTAMP 
,'D' 
,case 
  when (CLIENT USERID = ' ' or CLIENT USERID is null) then UPPER(CURRENT USER) else UPPER(CLIENT USERID) 
  end); 
